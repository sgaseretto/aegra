# SQLite Guide

Aegra supports SQLite as an alternative database backend, enabling **zero-external-dependency** local development. No Docker, no PostgreSQL -- just Python.

## Quick Start

```bash
pip install aegra-cli

# One command to init + run
aegra minimal
```

Or step-by-step:

```bash
aegra init --sqlite
cp .env.example .env
# Add your OPENAI_API_KEY to .env
aegra dev
```

## Configuration

SQLite mode is controlled by a single environment variable:

```bash
DATABASE_URL=sqlite:///./my_project.db
```

When `DATABASE_URL` starts with `sqlite`, Aegra automatically:
- Uses SQLite instead of PostgreSQL for all metadata (assistants, threads, runs)
- Uses `AsyncSqliteSaver` for LangGraph checkpoints
- Uses a custom `AsyncSqliteStore` with [sqlite-vec](https://github.com/asg017/sqlite-vec) for semantic search
- Skips Alembic migrations (tables created via `create_all()`)
- Skips Docker health checks in `aegra dev`

## Semantic Search with FastEmbed

SQLite mode supports persistent semantic search via sqlite-vec and FastEmbed. The default `aegra.json` generated by `aegra init --sqlite` includes:

```json
{
  "store": {
    "index": {
      "embed": "fastembed:BAAI/bge-small-en-v1.5",
      "dims": 384
    }
  }
}
```

This uses a local embedding model (no API key needed). The first run will download the model (~45MB).

### Supported Embedding Formats

| Format | Example | Notes |
|--------|---------|-------|
| `fastembed:MODEL` | `fastembed:BAAI/bge-small-en-v1.5` | Local model, no API key |
| `openai:MODEL` | `openai:text-embedding-3-small` | Requires `OPENAI_API_KEY` |

## Database File Location

The database file path is derived from `DATABASE_URL`:

```bash
# Relative path (resolved from CWD)
DATABASE_URL=sqlite:///./my_app.db

# Absolute path
DATABASE_URL=sqlite:////home/user/data/aegra.db
```

All data -- metadata, checkpoints, store items, and vectors -- lives in a single `.db` file.

## Comparison with PostgreSQL

| Feature | PostgreSQL | SQLite |
|---------|-----------|--------|
| Setup | Docker + pgvector | Zero deps |
| Concurrency | Multi-process | Single-writer |
| Vector search | pgvector | sqlite-vec |
| Migrations | Alembic | `create_all()` |
| Best for | Production, multi-user | Local dev, single-user |
| Persistence | Database server | Single file |

## Limitations

- **Single-writer**: SQLite uses WAL mode but is still limited to one writer at a time. Not suitable for production deployments with multiple workers.
- **No Alembic migrations**: Schema changes are applied via `create_all()`. For schema evolution in SQLite, delete the `.db` file and restart.
- **Local embeddings only by default**: FastEmbed runs locally. You can use OpenAI embeddings if preferred, but that requires an API key.

## Switching to PostgreSQL

To migrate from SQLite to PostgreSQL:

1. Remove `DATABASE_URL` from `.env` (or set it to a `postgresql://` URL)
2. Set `POSTGRES_*` environment variables
3. Start PostgreSQL (via Docker or hosted)
4. Run `aegra dev` -- Alembic will auto-migrate

Note: Data does not automatically transfer between backends. Export/import data manually if needed.
